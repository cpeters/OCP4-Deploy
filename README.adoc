= OCP_Deploy
Repo for deploying OCP to AWS

== Content

* <<Purpose, Purpose>>
* <<Architecture, Architecture>>
* <<Workflow, Workflow>>
* <<Important, Important>>
* <<TODO, TODO>>


== Purpose
* Provide a CI/CD method to deploy an OCP4 cluster
* Automated way to destroy cluster
* Provide Day 1 GitOps to setup cluster in uniform "fresh" status

== Architecture
* Domain is registered in AWS with hosted zone
* Review the install-config.yaml file
  ** The default set in this repo is a 3 node cluster that combines Control Plane nodes with compute nodes, because $$$
  ** If you use outside of this project, you may also want to change the cluster name

== Workflow
* To deploy OCP4.x
  ** Update variables in the install-config.yaml file
    *** baseDomain is the top level route53 domain
    *** region might need to be updated
  ** Ensure GitHub Secrets are created and up-to-date
    *** CLUSTER_ADMIN is the cluster admin username
    *** ADMIN_PASS is cluster admin password
    *** DEV_PASS is the password for andrew the developer
    *** PULL_SECRET is the required Red Hat creds for their repositories
    *** AWS_ACCESS_KEY_ID is the AWS Access Key
    *** AWS_SECRET_ACCESS_KEY is the AWS Secret Access key
  ** Create PR to merge deploy.md to main after adding name and date to list

NOTE: GitHub IDP is disabled currently

  ** IDP
    *** GitHub IDP is used in this deploy, so a GitHub organization should be created
    *** Add the clientSecret to GitHub Secrets as CLIENT_SECRET
    *** Update the GitHub Organization name and clientID in idp-oauth.yaml file

* To destroy OCP4.x
  ** Validate artifact for the cluster is still available
  ** Ensure GitHub Secrets for AWS creds are created and valid
  ** Create PR to merge destroy.md to main after adding name and date to list

== Important
* During the *deploy* workflow the artifacts around the AWS resources that are deployed are needed for the *destroy* workflow.  
* The artifacts are uploaded for only 90 days and will need to be *manually* downloaded if it's not planned to *destroy* the cluster within that retention period.

== TODO
* Add OCP openshift-installer version as variable
* How to tie the artifact from _Deploy_ workflow to _Destroy_ workflow?
* Day 1 Ops
  ** GitHub IDP 
  ** User RBAC
  ** Remove kubeadmin
